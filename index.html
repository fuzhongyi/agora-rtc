<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<div id="agora_local"></div>
<script src="https://cdn.agora.io/sdk/web/AgoraRTCSDK-2.5.1.js"></script>
<script>
  var APP_ID = '8d551adee0e04eed92aa078f7da226ec';
  var client = AgoraRTC.createClient({mode: 'rtc', codec: "h264"});
  var localStream = {};
  client.init(APP_ID, function () {
    console.log("客户端初始化成功");
    client.join(null, 'cctv', null, function (uid) {
      console.log("用户[" + uid + "]加入频道成功");
      localStream = AgoraRTC.createStream({
        streamID: uid,
        audio: true,
        video: false,
        screen: false
      });
      localStream.init(function () {
        console.log("媒体流初始化成功");
        localStream.play('agora_local');
        client.publish(localStream, function (err) {
          console.error("发布本地媒体流错误", err);
        });
        client.on('stream-published', function (evt) {
          console.log("发布本地媒体流成功");
        })
      }, function (err) {
        console.log("媒体流初始化失败", err);
      });
    }, function (err) {
      console.log("加入频道失败", err);
    });
    client.on('stream-added', function (evt) {
      var stream = evt.stream;
      console.log("有新的媒体流加入: " + stream.getId());
      client.subscribe(stream, function (err) {
        console.log("订阅媒体流失败", err);
      });
    });
    client.on('stream-subscribed', function (evt) {
      var remoteStream = evt.stream;
      console.log("成功订阅远程流: " + remoteStream.getId());
      remoteStream.play('agora_local');
    })
  }, function (err) {
    console.error("客户端初始化失败", err);
  });
</script>
</body>
</html>
